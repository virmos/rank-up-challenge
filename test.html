<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.1/font/bootstrap-icons.css">
    <link rel="stylesheet" href="public/css/styles.css">

    <title>Document</title>
</head>

<body>

    <header id="header">
        <div class="d-flex flex-column" id="menu">
            <div id="start"><span>Start Quiz!</span></div>
            <div id="quiz" style="display: none">
                <div id="question-container">
                    <div id="quizImg"></div>
                    <div id="question"></div>
                </div>
                <div id="choices">
                    <div class="choice" id="A" onclick="checkAnswer('A')"></div>
                    <div class="choice" id="B" onclick="checkAnswer('B')"></div>
                    <div class="choice" id="C" onclick="checkAnswer('C')"></div>
                    <div class="choice" id="D" onclick="checkAnswer('D')"></div>
                </div>
                <div id="timer">
                    <div id="counter"></div>
                    <div id="timeGauge"></div>
                </div>
                <div id="progress" class=""></div>
            </div>
            <div id="scoreContainer" style="display: none">
            </div>
        </div>
    </header>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const start = document.getElementById("start")
        const quiz = document.getElementById("quiz")
        const quizImg = document.getElementById("quizImg")
        const question = document.getElementById("question")
        const counter = document.getElementById("counter")
        const timeGauge = document.getElementById("timeGauge")
        const choiceA = document.getElementById("A")
        const choiceB = document.getElementById("B")
        const choiceC = document.getElementById("C")
        const choiceD = document.getElementById("D")
        const progress = document.getElementById("progress")

        const renderQuestion = () => {
            let q = questions[runningQuestionIndex]
            quizImg.innerHTML = `<img width="200px" height="200px" src="${q.imgSrc}">`
            question.innerHTML = `<p>"${q.question}"</p>`
            choiceA.innerHTML = `<i class="bi bi-suit-club-fill"> </i> <span> ${q.A} </span>`
            choiceB.innerHTML = `<i class="bi bi-suit-diamond-fill"> </i> <span> ${q.B} </span>`
            choiceC.innerHTML = `<i class="bi bi-suit-heart-fill"> </i> <span> ${q.C} </span>`
            choiceD.innerHTML = `<i class="bi bi-suit-spade-fill"> </i> <span> ${q.D} </span>`
        }

        const startQuiz = () => {
            start.style.display = "none"
            renderQuestion()
            quiz.style.display = "block"
            renderCounter()
            renderProgress()
            TIMER = setInterval(renderCounter, 1000)
        }

        const renderProgress = () => {
            for (let qIndex = 0; qIndex <= lastQuestionIndex; qIndex++) {
                progress.innerHTML += `<div class="prog" id="${qIndex}"</div>`
            }
        }


        const renderCounter = () => {
            if (count <= questionTime) {
                counter.innerHTML = count
                timeGauge.style.width = gaugeProgressUnit * count + "px"
                count++
            } else {
                count = 0
                answerIsWrong()
                if (runningQuestionIndex < lastQuestionIndex) {
                    runningQuestionIndex++
                    renderQuestion()
                } else {
                    clearInterval(TIMER)
                        // renderScore()
                }
            }
        }

        const checkAnswer = (answer) => {
            if (questions[runningQuestionIndex].correctAnswer == answer) {
                score++
                document.getElementById(runningQuestionIndex).style.backgroundColor = "green"
            } else {
                document.getElementById(runningQuestionIndex).style.backgroundColor = "red"
            }

            count = 0
            if (runningQuestionIndex < lastQuestionIndex) {
                runningQuestionIndex++
                renderQuestion()
            } else {
                clearInterval(TIMER)
            }
        }

        let questions = [];
        //------------Make the connection----------------
        var socket = io();



        //------------Get list question-----------------
        socket.on('ListQuestion', function(data) {
            questions = data;
        });

        //------------------------------------------------
        const questionTime = 10
        let lastQuestionIndex = questions.length - 1
        let runningQuestionIndex = 0

        const gaugeWidth = 150
        const gaugeProgressUnit = gaugeWidth / questionTime

        let count = 0
        let score = 0
        let TIMER

        start.addEventListener("click", startQuiz)
    </script>
</body>

</html>